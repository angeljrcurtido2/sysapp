#!/usr/bin/env bash

set -euo pipefail

echo "Configuring AndroidX and Jetifier in gradle.properties..."

# Wait for android folder to be generated by prebuild
if [ ! -d "android" ]; then
  echo "Running expo prebuild to generate android folder..."
  npx expo prebuild --platform android
fi

# Add AndroidX properties to gradle.properties
if [ -f "android/gradle.properties" ]; then
  echo "Adding AndroidX properties to gradle.properties..."

  # Check if properties already exist to avoid duplicates
  if ! grep -q "android.useAndroidX" android/gradle.properties; then
    cat >> android/gradle.properties << 'EOF'

# AndroidX and Jetifier - Required for compatibility
android.useAndroidX=true
android.enableJetifier=true
EOF
    echo "AndroidX properties added successfully"
  else
    echo "AndroidX properties already exist in gradle.properties"
  fi
else
  echo "ERROR: android/gradle.properties not found!"
  exit 1
fi

echo "Configuration completed successfully"
